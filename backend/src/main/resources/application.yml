spring:
  application:
    name: bulc-homepage-backend

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/bulc_homepage_db}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:postgres123}
    driver-class-name: org.postgresql.Driver
    hikari:
      connection-timeout: 5000
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 300000
      max-lifetime: 600000

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # OAuth2 소셜 로그인 설정
  security:
    oauth2:
      client:
        registration:
          naver:
            client-id: ${NAVER_CLIENT_ID}
            client-secret: ${NAVER_CLIENT_SECRET}
            redirect-uri: ${OAUTH2_CALLBACK_BASE_URL:http://localhost:8080}/api/auth/oauth2/callback/naver
            authorization-grant-type: authorization_code
            scope: name, email, mobile
            client-name: Naver
          kakao:
            client-id: ${KAKAO_CLIENT_ID}
            client-secret: ${KAKAO_CLIENT_SECRET}
            redirect-uri: ${OAUTH2_CALLBACK_BASE_URL:http://localhost:8080}/api/auth/oauth2/callback/kakao
            authorization-grant-type: authorization_code
            scope: account_email, name, phone_number
            client-name: Kakao
            client-authentication-method: client_secret_post
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            redirect-uri: ${OAUTH2_CALLBACK_BASE_URL:http://localhost:8080}/api/auth/oauth2/callback/google
            authorization-grant-type: authorization_code
            scope: profile, email
            client-name: Google
        provider:
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://www.googleapis.com/oauth2/v4/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub

# CORS Configuration
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:}

server:
  port: 8080

# Microsoft Graph API Mail Configuration
microsoft:
  graph:
    tenant-id: ${MS_TENANT_ID:}
    client-id: ${MS_CLIENT_ID:}
    client-secret: ${MS_CLIENT_SECRET:}

mail:
  from: ${MAIL_FROM:noreply@bulc.co.kr}
  from-accounts: ${MAIL_FROM_ACCOUNTS:accounts@bulc.co.kr}
  from-billing: ${MAIL_FROM_BILLING:billing@bulc.co.kr}
  reply-to: ${MAIL_REPLY_TO:juwon@msimul.com}

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:BulcHomepageSecretKeyForJwtTokenGeneration2024VeryLongSecretKey}
  access-token-expiration: ${JWT_ACCESS_EXPIRATION:3600000}
  refresh-token-expiration: ${JWT_REFRESH_EXPIRATION:2592000000}  # 30일 (30 * 24 * 60 * 60 * 1000)
  oauth-refresh-token-expiration: ${JWT_OAUTH_REFRESH_EXPIRATION:31536000000}  # 1년 (365 * 24 * 60 * 60 * 1000)

# OAuth2 Redirect URI
app:
  oauth2:
    redirect-uri: ${OAUTH2_REDIRECT_URI:http://localhost:3000/oauth/callback}

# Licensing Configuration (v1.1.2)
bulc:
  licensing:
    # RS256 개인키 (PKCS#8 PEM 형식)
    # 우선순위: private-key-base64 > private-key-path
    # 방법1: Base64 인코딩된 PEM 문자열 (K8s Secret, AWS SSM 등)
    private-key-base64: ${LIC_PRIVATE_KEY_BASE64:}
    # 방법2: PEM 파일 경로 (Docker volume mount 등)
    private-key-path: ${LIC_PRIVATE_KEY_PATH:}
    session-token:
      # sessionToken TTL (분), 기본 15분
      ttl-minutes: ${LIC_TOKEN_TTL_MINUTES:15}
      # 발급자 식별자
      issuer: ${LIC_TOKEN_ISSUER:bulc-license-server}
    # v0.3.0: Auto-Resolve용 stale 판정 기준 (분)
    # 이 시간 이상 heartbeat 없으면 stale로 간주하여 자동 종료 대상
    stale-threshold-minutes: ${LIC_STALE_THRESHOLD_MINUTES:30}

  # Redeem 코드 설정
  redeem:
    code-pepper: ${REDEEM_CODE_PEPPER:dev-redeem-pepper-2024}

  # OAuth 2.0 클라이언트 설정
  # 등록된 client_id와 redirect_uri만 허용됩니다.
  # 포트 와일드카드: http://localhost:*/path → 모든 포트 허용
  oauth:
    clients:
      meteor-app:
        display-name: "BUL-C Fire Simulator"
        allowed-redirect-uris:
          - meteor://oauth/callback
          - http://localhost:*/oauth/callback
          - http://127.0.0.1:*/oauth/callback
      bulc-app:
        display-name: "BulC"
        allowed-redirect-uris:
          - bulc://oauth/callback
          - http://localhost:*/oauth/callback
      bulc-desktop:
        display-name: "BulC Desktop"
        allowed-redirect-uris:
          - bulc://oauth/callback
          - http://localhost:*/oauth/callback
          - http://127.0.0.1:*/oauth/callback

# Toss Payments Configuration
toss:
  payments:
    client-key: ${TOSS_CLIENT_KEY:test_ck_Z1aOwX7K8mjmkLb4W0B03yQxzvNP}
    secret-key: ${TOSS_SECRET_KEY:test_sk_GePWvyJnrKK7xZb1lNdOrgLzN97E}
    success-url: ${TOSS_SUCCESS_URL:http://localhost:3000/payment/success}
    fail-url: ${TOSS_FAIL_URL:http://localhost:3000/payment/fail}

# 개발 환경 설정
---
spring:
  config:
    activate:
      on-profile: dev

  jpa:
    show-sql: true

# 운영 환경 설정
---
spring:
  config:
    activate:
      on-profile: prod

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate
