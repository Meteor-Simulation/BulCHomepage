# BulC Homepage 기술정의서

| 항목 | 내용 |
|------|------|
| 문서 버전 | v1.1 |
| 작성일 | 2026-02-04 |
| 프로젝트명 | BulC Homepage |

---

## 1. 개요

### 1.1 목적

본 문서는 BulC Homepage 시스템의 기술적 구현 사항을 정의합니다.

### 1.2 범위

- 개발 환경 및 기술 스택
- 프론트엔드/백엔드 아키텍처
- 데이터베이스 설계
- 보안 설정
- 외부 시스템 연동
- 배포 환경

---

## 2. 기술 스택

### 2.1 프론트엔드

| 구분 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **프레임워크** | React | 19.2.1 | UI 라이브러리 |
| **언어** | TypeScript | 4.9.5 | 정적 타입 |
| **라우팅** | React Router | 6.30.2 | SPA 라우팅 |
| **상태관리** | Context API | - | 전역 상태 (인증) |
| **차트** | Chart.js | 4.5.1 | 관리자 대시보드 차트 |
| **결제** | Toss Payments SDK | 1.9.2 | 결제 UI |
| **아이콘** | lucide-react | - | SVG 아이콘 라이브러리 |
| **빌드** | React Scripts | 5.0.1 | CRA 빌드 도구 |
| **테스트** | Testing Library | 16.3.0 | 컴포넌트 테스트 |

### 2.2 백엔드

| 구분 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **프레임워크** | Spring Boot | 3.2.0 | 웹 애플리케이션 |
| **언어** | Java | 17 (LTS) | 서버 언어 |
| **보안** | Spring Security | 6.x | 인증/인가 |
| **ORM** | Spring Data JPA | 3.x | 데이터 접근 |
| **JWT** | jjwt | 0.12.3 | 토큰 생성/검증 |
| **OAuth** | Spring OAuth2 Client | 6.x | 소셜 로그인 |
| **빌드** | Gradle | 8.x | 의존성 관리 |
| **개발도구** | Lombok | - | 보일러플레이트 감소 |

### 2.3 데이터베이스

| 구분 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **RDBMS** | PostgreSQL | 16 | 메인 데이터베이스 |
| **테스트 DB** | H2 | - | 단위 테스트용 인메모리 |
| **드라이버** | PostgreSQL JDBC | 42.x | 데이터베이스 연결 |

### 2.4 인프라

| 구분 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **컨테이너** | Docker | - | 컨테이너화 |
| **오케스트레이션** | Docker Compose | - | 멀티 컨테이너 관리 |
| **웹서버** | Nginx | - | 리버스 프록시 (프로덕션) |

---

## 3. 프론트엔드 상세

### 3.1 프로젝트 구조

```
frontend/
├── public/
│   ├── index.html
│   └── assets/              # 정적 이미지
├── src/
│   ├── index.tsx            # 엔트리 포인트
│   ├── index.css            # 전역 스타일
│   ├── context/
│   │   └── AuthContext.tsx  # 인증 상태 관리
│   ├── components/          # 공용 컴포넌트
│   │   ├── Header/
│   │   ├── Footer/
│   │   ├── LoginModal/
│   │   ├── SignupModal/
│   │   └── ...
│   ├── CategoryPages/       # 페이지 컴포넌트
│   │   ├── Main/
│   │   ├── METEOR/
│   │   ├── BULC/
│   │   ├── VR/
│   │   ├── Payment/
│   │   ├── MyPage/
│   │   └── Admin/
│   ├── hooks/               # 커스텀 훅
│   │   └── useScrollNav.ts  # 스크롤 기반 섹션 네비게이션 훅
│   └── utils/               # 유틸리티 함수
├── package.json
└── tsconfig.json
```

### 3.2 라우팅 설정

```typescript
// src/index.tsx
<BrowserRouter>
  <AuthProvider>
    <ErrorBoundary>
      <Header />
      <Routes>
        <Route path="/" element={<MainPage />} />
        <Route path="/meteor" element={<MeteorPage />} />
        <Route path="/bulc" element={<BulCPage />} />
        <Route path="/vr" element={<VRPage />} />
        <Route path="/payment" element={<PaymentPage />} />
        <Route path="/payment/success" element={<PaymentSuccess />} />
        <Route path="/payment/fail" element={<PaymentFail />} />
        <Route path="/mypage" element={<MyPage />} />
        <Route path="/admin" element={<AdminPage />} />
        <Route path="/oauth/callback" element={<OAuthCallback />} />
        <Route path="/oauth/setup-password" element={<OAuthSetupPassword />} />
        <Route path="*" element={<NotFoundPage />} />
      </Routes>
      <Footer />
    </ErrorBoundary>
  </AuthProvider>
</BrowserRouter>
```

### 3.3 상태 관리 (AuthContext)

```typescript
// src/context/AuthContext.tsx
interface AuthContextType {
  user: User | null;
  isLoggedIn: boolean;
  isAuthReady: boolean;
  sessionTimeLeft: number;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  refreshToken: () => Promise<void>;
}

// 토큰 저장 위치
- localStorage.accessToken
- localStorage.refreshToken
- localStorage.user
```

### 3.4 API 통신 패턴

```typescript
// API 호출 기본 패턴
const response = await fetch(`${API_URL}/api/endpoint`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${accessToken}`
  },
  body: JSON.stringify(data)
});

// 환경 변수
REACT_APP_API_URL=http://localhost:8080
```

### 3.5 스타일링

| 방식 | 용도 |
|------|------|
| CSS Modules | 컴포넌트별 스타일 (.css 파일) |
| CSS Variables | 테마 색상 관리 |
| 반응형 | min-width: 1024px 기준 |

**주요 CSS 변수:**
```css
:root {
  --accent: #C4320A;           /* 주요 강조 색상 */
  --background: #0a0a0a;       /* 배경 색상 */
  --text-primary: #ffffff;     /* 주요 텍스트 */
  --text-secondary: #a0a0a0;   /* 보조 텍스트 */
}
```

---

## 4. 백엔드 상세

### 4.1 프로젝트 구조

```
backend/
├── src/main/java/com/bulc/homepage/
│   ├── HomepageApplication.java     # Spring Boot 진입점
│   ├── config/
│   │   ├── SecurityConfig.java      # Spring Security 설정
│   │   ├── CorsConfig.java          # CORS 설정
│   │   └── MailConfig.java          # 메일 설정
│   ├── controller/                   # REST 컨트롤러
│   │   ├── AuthController.java
│   │   ├── UserController.java
│   │   ├── ProductController.java
│   │   ├── PaymentController.java
│   │   ├── SubscriptionController.java
│   │   ├── AdminController.java
│   │   └── ...
│   ├── service/                      # 비즈니스 로직
│   ├── entity/                       # JPA 엔티티
│   ├── dto/                          # 요청/응답 DTO
│   │   ├── request/
│   │   └── response/
│   ├── repository/                   # Spring Data JPA
│   ├── security/                     # JWT, 필터
│   │   ├── JwtTokenProvider.java
│   │   ├── JwtAuthenticationFilter.java
│   │   └── CustomUserDetailsService.java
│   ├── oauth2/                       # OAuth2 핸들러
│   ├── licensing/                    # 라이선싱 모듈
│   │   ├── controller/
│   │   ├── domain/
│   │   ├── service/
│   │   └── repository/
│   └── scheduler/                    # 스케줄러
├── src/main/resources/
│   ├── application.yml               # 메인 설정
│   └── application-test.yml          # 테스트 설정
├── src/test/                         # 테스트 코드
└── build.gradle                      # Gradle 설정
```

### 4.2 Spring Security 설정

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http
            .csrf(csrf -> csrf.disable())
            .sessionManagement(session ->
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/auth/**").permitAll()
                .requestMatchers("/api/products/**").permitAll()
                .requestMatchers("/api/admin/**").hasAnyRole("ADMIN", "MANAGER")
                .requestMatchers("/api/v1/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .addFilterBefore(jwtAuthenticationFilter,
                UsernamePasswordAuthenticationFilter.class);
        return http.build();
    }
}
```

### 4.3 JWT 토큰 설정

```yaml
# application.yml
jwt:
  secret: ${JWT_SECRET}
  access-token-expiration: 3600000     # 1시간 (밀리초)
  refresh-token-expiration: 86400000   # 24시간 (밀리초)
```

**토큰 구조:**
```
Header: { "alg": "HS256", "typ": "JWT" }
Payload: {
  "sub": "user@example.com",    # 사용자 이메일
  "iat": 1234567890,            # 발급 시간
  "exp": 1234571490             # 만료 시간
}
Signature: HMACSHA256(header.payload, secret)
```

### 4.4 권한 체계

| 역할 코드 | Spring Role | 권한 |
|-----------|-------------|------|
| 000 | ROLE_ADMIN | 모든 기능 |
| 001 | ROLE_MANAGER | 관리자 기능 (일부 제한) |
| 002 | ROLE_USER | 일반 기능 |

### 4.5 JPA 엔티티 설계 원칙

```java
@Entity
@Table(name = "table_name")
@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EntityName {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String requiredField;

    @Column(name = "created_at", nullable = false)
    @Builder.Default
    private LocalDateTime createdAt = LocalDateTime.now();

    @Column(name = "updated_at", nullable = false)
    @Builder.Default
    private LocalDateTime updatedAt = LocalDateTime.now();
}
```

### 4.6 API 응답 형식

```java
// 표준 응답 구조
public class ApiResponse<T> {
    private boolean success;
    private String message;
    private T data;

    public static <T> ApiResponse<T> success(String message, T data) {
        return new ApiResponse<>(true, message, data);
    }

    public static <T> ApiResponse<T> error(String message) {
        return new ApiResponse<>(false, message, null);
    }
}

// 응답 예시
{
    "success": true,
    "message": "로그인 성공",
    "data": {
        "accessToken": "eyJ...",
        "refreshToken": "eyJ...",
        "tokenType": "Bearer",
        "expiresIn": 3600,
        "user": { ... }
    }
}
```

---

## 5. 데이터베이스 상세

### 5.1 연결 설정

```yaml
# application.yml
spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:bulc_homepage_db}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:postgres123}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: validate    # 스키마 자동 생성 안함
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    show-sql: false
```

### 5.2 테이블 네이밍 규칙

| 규칙 | 예시 |
|------|------|
| 테이블명 | snake_case 복수형 (users, payments) |
| 컬럼명 | snake_case (created_at, user_email) |
| PK | id (BIGINT) 또는 도메인 필드 (email) |
| FK | {참조테이블}_id 또는 {참조테이블}_{참조컬럼} |
| 상태 컬럼 | status, is_active |
| 타임스탬프 | created_at, updated_at |

### 5.3 주요 테이블 목록

| 도메인 | 테이블 | 설명 |
|--------|--------|------|
| **사용자** | users | 사용자 계정 |
| | oauth_providers | OAuth 연동 정보 |
| | user_roles | 사용자 역할 |
| | roles | 역할 코드 |
| | refresh_tokens | 리프레시 토큰 |
| | password_reset_tokens | 비밀번호 재설정 토큰 |
| | token_blacklist | 무효화된 토큰 |
| **결제** | products | 상품 |
| | price_plans | 요금제 |
| | product_price_plan | 상품-요금제 연결 |
| | subscriptions | 구독 |
| | payments | 결제 내역 |
| | billing_keys | 빌링키 (자동결제) |
| | subscription_payments | 구독 결제 이력 |
| **로그** | login_history | 로그인 이력 |
| | user_security_log | 보안 로그 |
| | audit_trail | 감사 로그 |
| **라이선스** | license_plans | 라이선스 플랜 |
| | licenses | 라이선스 |
| | license_activations | 기기 활성화 |
| | license_sessions | 세션 정보 |

### 5.4 인덱스 전략

```sql
-- 자주 조회되는 컬럼에 인덱스 생성
CREATE INDEX idx_payments_user_email ON payments(user_email);
CREATE INDEX idx_subscriptions_user_email ON subscriptions(user_email);
CREATE INDEX idx_licenses_owner_id ON licenses(owner_id);
CREATE INDEX idx_token_blacklist_token ON token_blacklist(token);
```

---

## 6. 보안 설정

### 6.1 인증 흐름

```
1. 로그인 요청 (이메일, 비밀번호)
   ↓
2. BCrypt로 비밀번호 검증
   ↓
3. Access Token + Refresh Token 발급
   ↓
4. 클라이언트 localStorage에 저장
   ↓
5. API 요청 시 Authorization 헤더에 토큰 포함
   ↓
6. JwtAuthenticationFilter에서 토큰 검증
   ↓
7. SecurityContext에 인증 정보 설정
```

### 6.2 토큰 블랙리스트

```java
// 로그아웃 시 토큰 블랙리스트 등록
@Transactional
public void blacklistToken(String token, String userEmail) {
    LocalDateTime expiresAt = jwtTokenProvider.getExpirationFromToken(token);
    TokenBlacklist blacklist = TokenBlacklist.builder()
        .token(token)
        .userEmail(userEmail)
        .expiresAt(expiresAt)
        .build();
    tokenBlacklistRepository.save(blacklist);
}

// 매시간 만료된 토큰 정리
@Scheduled(fixedRate = 3600000)
public void cleanupExpiredTokens() {
    tokenBlacklistRepository.deleteExpiredTokens(LocalDateTime.now());
}
```

### 6.3 비밀번호 정책

| 항목 | 요구사항 |
|------|----------|
| 최소 길이 | 8자 이상 |
| 문자 조합 | 영문 + 숫자 + 특수문자 |
| 해싱 알고리즘 | BCrypt (강도 10) |

### 6.4 CORS 설정

```java
@Bean
public CorsConfigurationSource corsConfigurationSource() {
    CorsConfiguration configuration = new CorsConfiguration();
    configuration.setAllowedOriginPatterns(List.of(
        "http://localhost:*",
        "http://*.localhost:*",
        "http://127.0.0.1:*",
        "http://192.168.*.*:*"
    ));
    configuration.setAllowedMethods(Arrays.asList(
        "GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"
    ));
    configuration.setAllowedHeaders(Arrays.asList("*"));
    configuration.setAllowCredentials(true);
    return configuration;
}
```

---

## 7. 외부 시스템 연동

### 7.1 토스페이먼츠

**프론트엔드 SDK:**
```typescript
import { loadTossPayments } from '@tosspayments/payment-sdk';

const tossPayments = await loadTossPayments(clientKey);
await tossPayments.requestPayment('카드', {
  amount: 50000,
  orderId: 'order-id',
  orderName: '상품명',
  successUrl: `${window.location.origin}/payment/success`,
  failUrl: `${window.location.origin}/payment/fail`,
});
```

**백엔드 결제 승인:**
```java
// POST /api/payments/confirm
public PaymentResponse confirmPayment(PaymentConfirmRequest request) {
    // 토스페이먼츠 API 호출
    String url = "https://api.tosspayments.com/v1/payments/confirm";

    HttpHeaders headers = new HttpHeaders();
    headers.set("Authorization", "Basic " +
        Base64.getEncoder().encodeToString(
            (secretKey + ":").getBytes()));

    // 결제 승인 요청
    ResponseEntity<TossPaymentResponse> response =
        restTemplate.exchange(url, HttpMethod.POST,
            new HttpEntity<>(request, headers),
            TossPaymentResponse.class);

    // 금액 검증 및 저장
    validateAmount(request.getOrderId(), response.getBody().getTotalAmount());
    savePayment(response.getBody());
}
```

### 7.2 OAuth2 (Naver 예시)

```yaml
# application.yml
spring:
  security:
    oauth2:
      client:
        registration:
          naver:
            client-id: ${NAVER_CLIENT_ID}
            client-secret: ${NAVER_CLIENT_SECRET}
            redirect-uri: "{baseUrl}/api/auth/oauth2/callback/naver"
            authorization-grant-type: authorization_code
            scope: name, email
        provider:
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response
```

### 7.3 Microsoft Graph API (메일 발송)

```java
@Service
public class MailService {

    private final GraphServiceClient graphClient;

    public void sendEmail(String to, String subject, String body) {
        Message message = new Message();
        message.setSubject(subject);

        ItemBody itemBody = new ItemBody();
        itemBody.setContentType(BodyType.HTML);
        itemBody.setContent(body);
        message.setBody(itemBody);

        Recipient recipient = new Recipient();
        EmailAddress emailAddress = new EmailAddress();
        emailAddress.setAddress(to);
        recipient.setEmailAddress(emailAddress);
        message.setToRecipients(Collections.singletonList(recipient));

        graphClient.users(fromAddress)
            .sendMail(UserSendMailParameterSet.newBuilder()
                .withMessage(message)
                .build())
            .buildRequest()
            .post();
    }
}
```

---

## 8. 배포 환경

### 8.1 Docker Compose (개발)

```yaml
# docker-compose.yml
version: '3.8'
services:
  database:
    image: postgres:16
    container_name: bulc-db
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    ports:
      - "${DB_PORT}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql

  backend:
    build: ./backend
    container_name: bulc-backend
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - DB_HOST=database
    ports:
      - "8080:8080"
    depends_on:
      - database

  frontend:
    build: ./frontend
    container_name: bulc-frontend
    environment:
      - REACT_APP_API_URL=http://localhost:8080
    ports:
      - "3000:3000"
    depends_on:
      - backend

volumes:
  postgres_data:
```

### 8.2 Docker Compose (프로덕션)

```yaml
# docker-compose.prod.yml
version: '3.8'
services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./frontend/build:/usr/share/nginx/html
    depends_on:
      - backend

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.prod
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    # 포트 노출하지 않음 (nginx 통해서만 접근)
```

### 8.3 환경 변수

```bash
# .env
# 데이터베이스
DB_NAME=bulc_homepage_db
DB_USER=postgres
DB_PASSWORD=your_secure_password
DB_PORT=5432

# JWT
JWT_SECRET=your_very_long_secure_jwt_secret_key
JWT_ACCESS_EXPIRATION=3600000
JWT_REFRESH_EXPIRATION=86400000

# OAuth2
NAVER_CLIENT_ID=your_naver_client_id
NAVER_CLIENT_SECRET=your_naver_client_secret
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
KAKAO_CLIENT_ID=your_kakao_client_id
KAKAO_CLIENT_SECRET=your_kakao_client_secret

# 토스페이먼츠
TOSS_CLIENT_KEY=your_toss_client_key
TOSS_SECRET_KEY=your_toss_secret_key

# Microsoft Graph
MS_TENANT_ID=your_tenant_id
MS_CLIENT_ID=your_client_id
MS_CLIENT_SECRET=your_client_secret
MAIL_FROM=noreply@msimul.com
```

---

## 9. 개발 도구 및 컨벤션

### 9.1 코드 컨벤션

**Java:**
- Google Java Style Guide 준수
- Lombok 활용 (Getter, Builder, etc.)
- 메서드명: camelCase
- 상수: UPPER_SNAKE_CASE

**TypeScript:**
- ESLint + Prettier 적용
- 함수 컴포넌트 + Hooks 사용
- 인터페이스: PascalCase
- 변수/함수: camelCase

### 9.2 Git 브랜치 전략

```
main (배포)
  ├── develop (개발 통합)
  │     ├── feature/기능명
  │     ├── bugfix/버그명
  │     └── hotfix/긴급수정
```

### 9.3 커밋 메시지

```
feat: 새로운 기능 추가
fix: 버그 수정
docs: 문서 수정
style: 코드 포맷팅
refactor: 리팩토링
test: 테스트 코드
chore: 빌드/설정 변경
```

---

## 10. 테스트

### 10.1 백엔드 테스트

```bash
# 전체 테스트 실행
./gradlew test

# 특정 테스트 클래스 실행
./gradlew test --tests "LicenseServiceTest"
```

**테스트 구성:**
- 단위 테스트: Service, Domain 로직
- 통합 테스트: Controller + Repository
- 테스트 DB: H2 인메모리

### 10.2 프론트엔드 테스트

```bash
# 테스트 실행
npm test

# 커버리지 리포트
npm test -- --coverage
```

---

## 11. 문서 이력

| 버전 | 작성일 | 작성자 | 변경 내용 |
|------|--------|--------|----------|
| v1.0 | 2026-01-13 | - | 초안 작성 |
| v1.1 | 2026-02-04 | - | lucide-react 추가, useScrollNav 훅 추가, CORS 서브도메인 패턴 반영 |
