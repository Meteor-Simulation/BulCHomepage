# BulC Homepage 시스템 아키텍처

| 항목 | 내용 |
|------|------|
| 문서 버전 | v1.0 |
| 작성일 | 2026-01-13 |
| 프로젝트명 | BulC Homepage |

---

## 1. 개요

### 1.1 목적

본 문서는 BulC Homepage 시스템의 전체 아키텍처를 정의합니다.

### 1.2 아키텍처 원칙

| 원칙 | 설명 |
|------|------|
| **Stateless** | 서버에 세션 상태 저장하지 않음 (JWT 기반) |
| **계층 분리** | 프론트엔드/백엔드/데이터베이스 분리 |
| **컨테이너화** | Docker 기반 배포 |
| **RESTful** | REST API 설계 원칙 준수 |

---

## 2. 전체 시스템 구조

### 2.1 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              외부 사용자                                      │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────────┐              │
│  │ 웹 브라우저│   │클라이언트앱│   │   관리자  │   │ 모바일 브라우저│              │
│  └─────┬────┘   └─────┬────┘   └─────┬────┘   └──────┬───────┘              │
└────────┼──────────────┼──────────────┼───────────────┼──────────────────────┘
         │              │              │               │
         ▼              ▼              ▼               ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           인터넷 / HTTPS                                     │
└─────────────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Nginx (프로덕션)                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  - SSL/TLS 종단                                                      │    │
│  │  - 정적 파일 서빙 (React 빌드)                                        │    │
│  │  - /api/* → Backend Proxy                                           │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
         │
         ├──────────────────────┬──────────────────────┐
         ▼                      ▼                      ▼
┌─────────────────┐   ┌─────────────────┐   ┌─────────────────────────────────┐
│    Frontend     │   │    Backend      │   │       Database                  │
│   (React 19)    │   │ (Spring Boot)   │   │    (PostgreSQL 16)              │
│                 │   │                 │   │                                 │
│ ┌─────────────┐ │   │ ┌─────────────┐ │   │ ┌─────────────────────────────┐ │
│ │ AuthContext │ │   │ │ Controller  │ │   │ │ users                       │ │
│ │ 인증 상태    │ │   │ │ REST API    │ │   │ │ payments                    │ │
│ └─────────────┘ │   │ └──────┬──────┘ │   │ │ subscriptions               │ │
│                 │   │        │        │   │ │ licenses                    │ │
│ ┌─────────────┐ │   │ ┌──────▼──────┐ │   │ │ ...                         │ │
│ │ Components  │ │   │ │   Service   │ │   │ └─────────────────────────────┘ │
│ │ UI 컴포넌트  │ │   │ │ 비즈니스 로직│ │   │                                 │
│ └─────────────┘ │   │ └──────┬──────┘ │   │                                 │
│                 │   │        │        │   │                                 │
│ Port: 3000      │   │ ┌──────▼──────┐ │   │ Port: 5432                      │
│                 │   │ │ Repository  │◄┼───┼─►                               │
│                 │   │ │ 데이터 접근  │ │   │                                 │
│                 │   │ └─────────────┘ │   │                                 │
│                 │   │                 │   │                                 │
│                 │   │ Port: 8080      │   │                                 │
└─────────────────┘   └─────────────────┘   └─────────────────────────────────┘
         │                    │
         │                    ├─────────────────┬─────────────────┐
         │                    ▼                 ▼                 ▼
         │           ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
         │           │ 토스페이먼츠  │  │   OAuth2     │  │  MS Graph    │
         │           │  결제 API    │  │ (Google,     │  │  메일 발송    │
         │           │              │  │  Naver,      │  │              │
         │           │              │  │  Kakao)      │  │              │
         │           └──────────────┘  └──────────────┘  └──────────────┘
         │
         ▼
┌─────────────────┐
│  Toss Payments  │
│    결제 SDK     │
│ (클라이언트 측)  │
└─────────────────┘
```

---

## 3. 계층 아키텍처

### 3.1 프론트엔드 계층

```
┌─────────────────────────────────────────────────────────────────┐
│                     Frontend Layer                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    Presentation Layer                       │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │ │
│  │  │MainPage  │  │PaymentPage│  │ MyPage   │  │AdminPage │   │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    Component Layer                          │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │ │
│  │  │ Header   │  │LoginModal│  │SignupModal│  │ Footer   │   │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                     State Layer                             │ │
│  │  ┌─────────────────────────────────────────────────────┐   │ │
│  │  │                   AuthContext                        │   │ │
│  │  │  - user: User | null                                 │   │ │
│  │  │  - isLoggedIn: boolean                               │   │ │
│  │  │  - login(), logout(), refreshToken()                 │   │ │
│  │  └─────────────────────────────────────────────────────┘   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                     API Layer                               │ │
│  │  ┌─────────────────────────────────────────────────────┐   │ │
│  │  │               fetch() + Authorization Header         │   │ │
│  │  │               REACT_APP_API_URL/api/*                │   │ │
│  │  └─────────────────────────────────────────────────────┘   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 백엔드 계층

```
┌─────────────────────────────────────────────────────────────────┐
│                      Backend Layer                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    Security Layer                           │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │ │
│  │  │ JwtFilter   │  │TokenBlacklist│  │ OAuth2Handlers     │ │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘ │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                   Controller Layer                          │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │ │
│  │  │AuthCtrl  │  │PaymentCtrl│  │ UserCtrl │  │AdminCtrl │   │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐                 │ │
│  │  │LicenseCtrl│  │SubsCtrl  │  │ProductCtrl│                │ │
│  │  └──────────┘  └──────────┘  └──────────┘                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    Service Layer                            │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │ │
│  │  │AuthSvc   │  │PaymentSvc│  │ UserSvc  │  │LicenseSvc│   │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐                 │ │
│  │  │MailSvc   │  │BillingSvc│  │SchedulerSvc│                │ │
│  │  └──────────┘  └──────────┘  └──────────┘                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                   Repository Layer                          │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │ │
│  │  │UserRepo  │  │PaymentRepo│  │LicenseRepo│  │ ...      │   │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    Entity Layer                             │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │ │
│  │  │  User    │  │ Payment  │  │ License  │  │Subscription│  │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 인증 아키텍처

### 4.1 JWT 인증 흐름

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           JWT 인증 아키텍처                                    │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [Client]                                                    [Server]        │
│     │                                                           │            │
│     │  1. POST /api/auth/login                                  │            │
│     │     {email, password}                                     │            │
│     ├──────────────────────────────────────────────────────────►│            │
│     │                                                           │            │
│     │                              ┌─────────────────────────┐  │            │
│     │                              │ 2. BCrypt 비밀번호 검증   │  │            │
│     │                              │ 3. Access Token 생성     │  │            │
│     │                              │ 4. Refresh Token 생성    │  │            │
│     │                              └─────────────────────────┘  │            │
│     │                                                           │            │
│     │  5. Response: {accessToken, refreshToken}                 │            │
│     │◄──────────────────────────────────────────────────────────│            │
│     │                                                           │            │
│  ┌──┴──┐                                                        │            │
│  │Local│  6. 토큰 저장                                          │            │
│  │Store│                                                        │            │
│  └──┬──┘                                                        │            │
│     │                                                           │            │
│     │  7. API 요청                                              │            │
│     │     Authorization: Bearer <accessToken>                   │            │
│     ├──────────────────────────────────────────────────────────►│            │
│     │                              ┌─────────────────────────┐  │            │
│     │                              │ 8. JwtAuthenticationFilter│  │            │
│     │                              │    - 토큰 추출           │  │            │
│     │                              │    - 서명 검증           │  │            │
│     │                              │    - 블랙리스트 확인     │  │            │
│     │                              │    - SecurityContext 설정│  │            │
│     │                              └─────────────────────────┘  │            │
│     │                                                           │            │
│     │  9. API 응답                                              │            │
│     │◄──────────────────────────────────────────────────────────│            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 토큰 갱신 흐름

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                          토큰 갱신 흐름                                        │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [Client]                                                    [Server]        │
│     │                                                           │            │
│     │  1. API 요청 (만료된 accessToken)                          │            │
│     ├──────────────────────────────────────────────────────────►│            │
│     │                                                           │            │
│     │  2. 401 Unauthorized                                      │            │
│     │◄──────────────────────────────────────────────────────────│            │
│     │                                                           │            │
│     │  3. POST /api/auth/refresh                                │            │
│     │     {refreshToken}                                        │            │
│     ├──────────────────────────────────────────────────────────►│            │
│     │                                                           │            │
│     │                              ┌─────────────────────────┐  │            │
│     │                              │ 4. Refresh Token 검증    │  │            │
│     │                              │ 5. 새 Access Token 생성  │  │            │
│     │                              │ 6. 새 Refresh Token 생성 │  │            │
│     │                              └─────────────────────────┘  │            │
│     │                                                           │            │
│     │  7. Response: {newAccessToken, newRefreshToken}           │            │
│     │◄──────────────────────────────────────────────────────────│            │
│     │                                                           │            │
│     │  8. 새 토큰으로 재요청                                      │            │
│     ├──────────────────────────────────────────────────────────►│            │
│     │                                                           │            │
│     │  9. 정상 응답                                              │            │
│     │◄──────────────────────────────────────────────────────────│            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 OAuth 로그인 흐름

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                          OAuth2 로그인 흐름                                   │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [Browser]           [Backend]           [OAuth Provider]                    │
│     │                    │                      │                            │
│     │  1. OAuth 버튼 클릭  │                      │                            │
│     ├───────────────────►│                      │                            │
│     │                    │                      │                            │
│     │  2. Redirect to OAuth Provider            │                            │
│     │◄───────────────────│                      │                            │
│     │                    │                      │                            │
│     │  3. 사용자 인증 및 동의                     │                            │
│     ├───────────────────────────────────────────►│                            │
│     │                    │                      │                            │
│     │  4. Callback with authorization code      │                            │
│     │◄───────────────────────────────────────────│                            │
│     │                    │                      │                            │
│     │  5. Code 전달       │                      │                            │
│     ├───────────────────►│                      │                            │
│     │                    │                      │                            │
│     │                    │  6. Code → Token 교환 │                            │
│     │                    ├─────────────────────►│                            │
│     │                    │                      │                            │
│     │                    │  7. User Info 조회    │                            │
│     │                    ├─────────────────────►│                            │
│     │                    │                      │                            │
│     │                    │◄─────────────────────│                            │
│     │                    │                      │                            │
│     │                ┌───┴───┐                  │                            │
│     │                │신규 사용자?│                │                            │
│     │                └───┬───┘                  │                            │
│     │                    │                      │                            │
│     │     ┌──────────────┴──────────────┐       │                            │
│     │     │                             │       │                            │
│     │   [신규]                        [기존]     │                            │
│     │     │                             │       │                            │
│     │  8a. /oauth/setup-password     8b. JWT 발급                            │
│     │     + tempToken                    │       │                            │
│     │◄────┘                             │       │                            │
│     │                                   │       │                            │
│     │  9a. 비밀번호 설정 후 회원가입      │       │                            │
│     ├───────────────────►               │       │                            │
│     │                                   │       │                            │
│     │  10. JWT 토큰 발급                │       │                            │
│     │◄──────────────────────────────────┘       │                            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 결제 아키텍처

### 5.1 결제 처리 흐름

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           결제 처리 흐름                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [Browser]           [Backend]           [Toss Payments]                     │
│     │                    │                      │                            │
│     │  1. 상품/요금제 선택 │                      │                            │
│     │  2. 결제 정보 입력   │                      │                            │
│     │                    │                      │                            │
│     │  3. 토스페이먼츠 SDK 호출                   │                            │
│     ├───────────────────────────────────────────►│                            │
│     │                    │                      │                            │
│     │  4. 결제창 표시 + 결제 진행                 │                            │
│     │◄──────────────────────────────────────────│                            │
│     │                    │                      │                            │
│     │  5. 결제 완료 → successUrl 리다이렉트       │                            │
│     │     ?paymentKey=xxx&orderId=xxx&amount=xxx│                            │
│     │                    │                      │                            │
│     │  6. POST /api/payments/confirm            │                            │
│     │     {paymentKey, orderId, amount}         │                            │
│     ├───────────────────►│                      │                            │
│     │                    │                      │                            │
│     │                    │  7. 결제 승인 API 호출 │                            │
│     │                    │     POST /v1/payments/confirm                     │
│     │                    ├─────────────────────►│                            │
│     │                    │                      │                            │
│     │                    │  8. 승인 결과         │                            │
│     │                    │◄─────────────────────│                            │
│     │                    │                      │                            │
│     │                ┌───┴───┐                  │                            │
│     │                │금액 검증│                  │                            │
│     │                │DB 저장 │                  │                            │
│     │                │라이선스 발급               │                            │
│     │                └───┬───┘                  │                            │
│     │                    │                      │                            │
│     │  9. 결제 완료 응답  │                      │                            │
│     │◄───────────────────│                      │                            │
│     │                    │                      │                            │
│     │  10. /payment/success 이동                │                            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 자동 결제 (구독 갱신)

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                        자동 결제 (빌링키) 흐름                                  │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [Scheduler]          [Backend]           [Toss Payments]                    │
│     │                    │                      │                            │
│     │  1. 매일 09:00 실행 │                      │                            │
│     │  (구독 갱신 확인)   │                      │                            │
│     ├───────────────────►│                      │                            │
│     │                    │                      │                            │
│     │                ┌───┴───┐                  │                            │
│     │                │오늘 갱신│                  │                            │
│     │                │대상 조회│                  │                            │
│     │                └───┬───┘                  │                            │
│     │                    │                      │                            │
│     │                    │  2. 빌링키 결제 API   │                            │
│     │                    │     POST /v1/billing/{billingKey}                 │
│     │                    ├─────────────────────►│                            │
│     │                    │                      │                            │
│     │                    │  3. 결제 결과         │                            │
│     │                    │◄─────────────────────│                            │
│     │                    │                      │                            │
│     │                ┌───┴───┐                  │                            │
│     │                │성공 시:│                  │                            │
│     │                │- 구독 갱신               │                            │
│     │                │- 결제 이력 저장           │                            │
│     │                │- 다음 결제일 업데이트      │                            │
│     │                │                         │                            │
│     │                │실패 시:                  │                            │
│     │                │- 재시도 예약 (14:00, 18:00)│                           │
│     │                │- 알림 발송               │                            │
│     │                └───┬───┘                  │                            │
│     │                    │                      │                            │
│     │  4. 처리 완료       │                      │                            │
│     │◄───────────────────│                      │                            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 라이선스 아키텍처

### 6.1 라이선스 검증 흐름

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                          라이선스 검증 흐름                                    │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [Client App]                                           [Backend]            │
│     │                                                       │                │
│     │  1. POST /api/v1/licenses/validate                    │                │
│     │     {licenseKey, deviceFingerprint, deviceDisplayName}│                │
│     ├──────────────────────────────────────────────────────►│                │
│     │                                                       │                │
│     │                                   ┌───────────────────┴───┐            │
│     │                                   │ 2. 라이선스 검증         │            │
│     │                                   │    - 유효성 확인        │            │
│     │                                   │    - 상태 확인         │            │
│     │                                   │    - 만료일 확인       │            │
│     │                                   └───────────────────┬───┘            │
│     │                                                       │                │
│     │                                   ┌───────────────────┴───┐            │
│     │                                   │ 3. Auto-Resolve       │            │
│     │                                   │                       │            │
│     │                                   │ a. 빈 슬롯 있음        │            │
│     │                                   │    → 바로 활성화       │            │
│     │                                   │                       │            │
│     │                                   │ b. Stale 세션 있음     │            │
│     │                                   │    → 자동 종료 후 활성화│            │
│     │                                   │                       │            │
│     │                                   │ c. 모두 Full           │            │
│     │                                   │    → 409 Conflict     │            │
│     │                                   │    → 세션 목록 반환    │            │
│     │                                   └───────────────────┬───┘            │
│     │                                                       │                │
│     │  4. Response (성공 시)                                 │                │
│     │     {sessionToken, offlineToken, expiresAt}            │                │
│     │◄──────────────────────────────────────────────────────│                │
│     │                                                       │                │
│  ┌──┴──┐                                                    │                │
│  │토큰 │  5. 토큰 저장 (로컬)                                 │                │
│  │저장 │                                                    │                │
│  └──┬──┘                                                    │                │
│     │                                                       │                │
│     │  6. Heartbeat (15분마다)                               │                │
│     │     POST /api/v1/licenses/heartbeat                   │                │
│     ├──────────────────────────────────────────────────────►│                │
│     │                                                       │                │
│     │  7. 갱신된 토큰                                        │                │
│     │◄──────────────────────────────────────────────────────│                │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 라이선스 상태 흐름

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                          라이선스 상태 흐름                                    │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                              ┌─────────┐                                     │
│                              │ PENDING │                                     │
│                              └────┬────┘                                     │
│                                   │ 결제 완료                                 │
│                                   ▼                                          │
│                              ┌─────────┐                                     │
│      ┌───────────────────────│ ACTIVE  │───────────────────┐                │
│      │                       └────┬────┘                   │                │
│      │                            │                        │                │
│      │ 정지 요청                   │ 만료                   │ 취소/환불       │
│      ▼                            ▼                        ▼                │
│  ┌─────────┐            ┌──────────────┐            ┌─────────┐             │
│  │SUSPENDED│            │EXPIRED_GRACE │            │ REVOKED │             │
│  └────┬────┘            └──────┬───────┘            └─────────┘             │
│       │                        │                                            │
│       │ 복구                    │ 유예기간 만료                               │
│       ▼                        ▼                                            │
│  ┌─────────┐            ┌──────────────┐                                    │
│  │ ACTIVE  │            │ EXPIRED_HARD │                                    │
│  └─────────┘            └──────────────┘                                    │
│                                                                              │
│  ※ REVOKED 상태는 복구 불가                                                  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 데이터 아키텍처

### 7.1 ERD 개요

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                              ERD 개요                                         │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────┐     ┌───────────┐     ┌───────────┐                          │
│  │   users   │────►│ payments  │     │  products │                          │
│  │  (email)  │     │           │     │  (code)   │                          │
│  └─────┬─────┘     └───────────┘     └─────┬─────┘                          │
│        │                                    │                                │
│        │                                    │                                │
│        ▼                                    ▼                                │
│  ┌───────────┐                       ┌───────────┐                          │
│  │subscriptions│◄────────────────────│price_plans│                          │
│  │           │                       │           │                          │
│  └─────┬─────┘                       └─────┬─────┘                          │
│        │                                    │                                │
│        │                                    │                                │
│        ▼                                    ▼                                │
│  ┌───────────┐                       ┌───────────┐                          │
│  │billing_keys│                      │license_plans│                         │
│  │           │                       │           │                          │
│  └───────────┘                       └─────┬─────┘                          │
│                                            │                                │
│                                            ▼                                │
│                                      ┌───────────┐                          │
│                                      │ licenses  │                          │
│                                      │           │                          │
│                                      └─────┬─────┘                          │
│                                            │                                │
│                                            ▼                                │
│                                      ┌───────────┐                          │
│                                      │activations│                          │
│                                      │           │                          │
│                                      └───────────┘                          │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 도메인별 테이블

| 도메인 | 테이블 | 관계 |
|--------|--------|------|
| **사용자** | users | 중심 엔티티 |
| | oauth_providers | users 1:N |
| | user_roles | users N:1 roles |
| | token_blacklist | users 1:N |
| **결제** | payments | users 1:N |
| | subscriptions | users 1:N, price_plans N:1 |
| | billing_keys | users 1:N |
| **상품** | products | 독립 |
| | price_plans | products 1:N |
| **라이선스** | licenses | users 1:N, license_plans N:1 |
| | license_activations | licenses 1:N |

---

## 8. 배포 아키텍처

### 8.1 개발 환경

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           개발 환경 구성                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                        Docker Compose                                 │   │
│  │                                                                       │   │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                  │   │
│  │   │   Frontend  │  │   Backend   │  │  Database   │                  │   │
│  │   │             │  │             │  │             │                  │   │
│  │   │ React Dev   │  │ Spring Boot │  │ PostgreSQL  │                  │   │
│  │   │ Server      │  │ DevTools    │  │             │                  │   │
│  │   │             │  │             │  │             │                  │   │
│  │   │ :3000       │  │ :8080       │  │ :5432       │                  │   │
│  │   │             │  │             │  │             │                  │   │
│  │   │ Hot Reload  │  │ Hot Reload  │  │ Volume:     │                  │   │
│  │   │             │  │             │  │ postgres_data                  │   │
│  │   └─────────────┘  └─────────────┘  └─────────────┘                  │   │
│  │                                                                       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 8.2 프로덕션 환경

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                          프로덕션 환경 구성                                    │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                        Docker Compose (Prod)                          │   │
│  │                                                                       │   │
│  │   ┌─────────────────────────────────────────────────────────────┐    │   │
│  │   │                        Nginx                                 │    │   │
│  │   │                                                              │    │   │
│  │   │   - SSL/TLS Termination (Let's Encrypt)                     │    │   │
│  │   │   - Static Files (React Build)                              │    │   │
│  │   │   - Reverse Proxy (/api/* → Backend)                        │    │   │
│  │   │   - Gzip Compression                                        │    │   │
│  │   │   - Cache Headers                                           │    │   │
│  │   │                                                              │    │   │
│  │   │   :80, :443                                                  │    │   │
│  │   └──────────────────────────┬──────────────────────────────────┘    │   │
│  │                              │                                       │   │
│  │                              ▼                                       │   │
│  │   ┌─────────────┐  ┌─────────────┐                                  │   │
│  │   │   Backend   │  │  Database   │                                  │   │
│  │   │             │  │             │                                  │   │
│  │   │ Spring Boot │  │ PostgreSQL  │                                  │   │
│  │   │ (Prod Mode) │  │             │                                  │   │
│  │   │             │  │             │                                  │   │
│  │   │ Internal    │  │ :5432       │                                  │   │
│  │   │ Network Only│  │ (Internal)  │                                  │   │
│  │   │             │  │             │                                  │   │
│  │   └─────────────┘  └─────────────┘                                  │   │
│  │                                                                       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 보안 아키텍처

### 9.1 보안 계층

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           보안 계층 구조                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ Layer 1: Network Security                                             │   │
│  │   - HTTPS Only (TLS 1.2+)                                            │   │
│  │   - CORS Policy                                                      │   │
│  │   - Rate Limiting (계획)                                              │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ Layer 2: Authentication                                               │   │
│  │   - JWT Token Validation                                             │   │
│  │   - Token Blacklist Check                                            │   │
│  │   - OAuth2 Integration                                               │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ Layer 3: Authorization                                                │   │
│  │   - Role-Based Access Control (RBAC)                                 │   │
│  │   - Method-Level Security (@PreAuthorize)                            │   │
│  │   - Resource Ownership Check                                         │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ Layer 4: Data Security                                                │   │
│  │   - Password Hashing (BCrypt)                                        │   │
│  │   - Sensitive Data Masking                                           │   │
│  │   - SQL Injection Prevention (Prepared Statements)                   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                    │                                         │
│                                    ▼                                         │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ Layer 5: Audit & Monitoring                                           │   │
│  │   - Activity Logging                                                 │   │
│  │   - Security Event Logging                                           │   │
│  │   - Login History                                                    │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. 문서 이력

| 버전 | 작성일 | 작성자 | 변경 내용 |
|------|--------|--------|----------|
| v1.0 | 2026-01-13 | - | 초안 작성 |
